<!DOCTYPE HTML>
<html>
  <head>
    <title>Behave</title>
  </head>
  <body>
    <!-- <script src="http://localhost:35729/livereload.js"></script> -->
    <script src="lib/bluebird.js"></script>
    <script src="lib/es6-module-loader.js"></script>
    <script type="module">
      import { Behave } from 'src/behave';
      import { BehaviorTree, Task, FunctionTask, PrintTask, Sequence } from 'src/bt';
      import 'src/behave_plugin';

      var value = 0;
      var incrementFunc = function() { value++; return true; };
      var printValueFunc = function() { console.log('value', value); return true; };

      var sequence = new Sequence()
        .add(new FunctionTask(printValueFunc))
        .add(new FunctionTask(incrementFunc), new FunctionTask(printValueFunc))
        .add(new FunctionTask(() => undefined))
        .add(new FunctionTask(incrementFunc), new FunctionTask(printValueFunc));

      // var bt = new BehaviorTree();
      // bt.add(sequence);

      console.log(Behave);

      var bt = Behave.create(sequence, { dummyPlugin: true });
      // var bt2 = Behave.create(new FunctionTask(() => true));

      bt.on('activate', function() {
        console.log('triggered by "activate" #1');
      });

      bt.on('before_execute', function() {
        console.log('triggered by "before_execute" #1');
        // return false;
      });

      bt.on('after_execute', function() {
        console.log('triggered by "after_execute" #1');
      });

      Behave.activate();

      console.log('result', Behave.execute());

      // var successFunc = (callback) => callback(null, true);
      // var failureFunc = (callback) => callback('failure', null);

      // sequence.add(new FunctionTask(successFunc));
      // sequence.add(new PrintTask('Hi'));
      // sequence.add(new PrintTask('Hello'));
      // sequence.add(new FunctionTask(failureFunc));
      // sequence.add(new PrintTask('Yo'));
      //var promiseSequence = Promise.promisify(sequence.execute);

      Promise.onPossiblyUnhandledRejection(function(error){
        console.log('Fail', error);
        //throw error;
      });

      // sequence.promiseExecuteAll().then(function(result) {
      //   console.log('result', result);
      // }).catch(function(e){
      //   console.log('Error ', e);
      // });



      // dynamic loading API
      // System.import('src/bt').then(function(module) {
      //   var t = new module.Task();
      //   var st = new module.SucceedingTask();
      //   console.log('result', st.execute());
      //   console.log('result', t.execute());
      // }, function(err) {
      //   console.log('Oh noes, it failed: ', err);
      // });
    </script>
  </body>
</html>
